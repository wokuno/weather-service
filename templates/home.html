<!DOCTYPE html>
<html>
<head>
    <title>Weather Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Weather Dashboard</h1>

    <h2>Latest Weather Data</h2>
    <p>Temperature: <span id="temperature"></span></p>
    <p>Pressure: <span id="pressure"></span></p>

    <h2>Historical Weather Data</h2>
    <form method="GET" action="/">
        <label for="duration">Select Duration:</label>
        <select name="duration" id="duration">
            <option value="1h" {{ if eq .Duration "1h" }}selected{{ end }}>Past 1 Hour</option>
            <option value="12h" {{ if eq .Duration "12h" }}selected{{ end }}>Past 12 Hours</option>
            <option value="24h" {{ if eq .Duration "24h" }}selected{{ end }}>Past 24 Hours</option>
            <option value="72h" {{ if eq .Duration "72h" }}selected{{ end }}>Past 3 Days</option>
            <option value="120h" {{ if eq .Duration "120h" }}selected{{ end }}>Past 5 Days</option>
            <option value="168h" {{ if eq .Duration "168h" }}selected{{ end }}>Past 1 Week</option>
        </select>
        <input type="submit" value="Update">
    </form>

    <svg id="chart"></svg>

    <script>
        // Function to update the latest weather data
        const updateLatestData = () => {
            fetch('/data')
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    document.getElementById('temperature').textContent = data.LatestData.Temperature;
                    document.getElementById('pressure').textContent = data.LatestData.Pressure;

                    // Update the chart
                    updateChart(data.HistoricalData, data.LatestData);
                });
        };

        // Function to update the chart with new data
        const updateChart = (historicalData, latestData) => {
        const timestamps = historicalData.map(d => new Date(d.Timestamp));
        const temperatures = historicalData.map(d => d.Temperature);
        const pressures = historicalData.map(d => d.Pressure);

        timestamps.push(new Date(latestData.Timestamp));
        temperatures.push(latestData.Temperature);
        pressures.push(latestData.Pressure);

        const ctx = document.getElementById('chart').getContext('2d');

        new Chart(ctx, {
            type: 'line',
            data: {
            labels: timestamps,
            datasets: [
                {
                label: 'Temperature',
                data: temperatures,
                borderColor: 'red',
                fill: false,
                },
                {
                label: 'Pressure',
                data: pressures,
                borderColor: 'blue',
                fill: false,
                },
            ],
            },
            options: {
            responsive: true,
            maintainAspectRatio: false,
            },
        });
        };

        // Fetch initial data and update the chart
        updateLatestData();

        // Update latest data and chart periodically
        setInterval(() => {
            updateLatestData();
        }, 5000);
    </script>
</body>
</html>
